<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="QuickLoan Calc - Easily calculate your loan payments and see how much interest you can save with extra payments.">
    <title>QuickLoan Calc - Your Smart Loan Calculator</title>
    <style>
        /* CSS styles... */
    </style>
</head>
<body>
    <div class="container">
        <h1>QuickLoan Calc</h1>
        <div>
            <label for="amount">Amount Financed:</label>
            <input type="number" id="amount" />
        </div>
        <div>
            <label for="interestRate">Interest Rate (%):</label>
            <input type="number" id="interestRate" step="0.01" />
        </div>
        <div>
            <label for="loanTerm">Loan Term:</label>
            <span id="loanTermDisplay"></span> <!-- Moved above the slider -->
            <input type="range" id="loanTerm">
        </div>
        <div>
            <label for="desiredInterestRate">Desired Interest Rate (%):</label>
            <input type="number" id="desiredInterestRate" step="0.01" />
        </div>
        <div>
            <label class="slider-label" for="extraPayment">Extra Monthly Payment: <span id="extraPaymentDisplay">$25</span></label>
            <input type="range" id="extraPayment" min="25" max="500" value="25" step="25">
        </div>
        <button onclick="document.getElementById('calculateButtonClicked').value = 'true'; calculateLoan()">Calculate</button>
        <input type="hidden" id="calculateButtonClicked" value="false">

        <div id="results">
            <!-- Results will be displayed here -->
        </div>

        <div id="effectiveRateDisclaimer">
            <h2>Effective Interest Rate Calculation Disclaimer</h2>
            <p>The effective interest rate shown is calculated based on the total interest paid over the actual duration of the loan, taking into account any extra payments made. It represents the annualized interest rate you effectively pay, differing from the nominal rate due to these additional payments.</p>
        </div>

        <div id="instructions">
            <h2>Instructions</h2>
            <p>Enter the loan amount, interest rate, desired interest rate, and select a loan term. Optionally, enter an extra monthly payment amount. Click 'Calculate' to see the detailed payment breakdown, including the effective interest rate with extra payments, comparisons with adjacent loan terms, and the extra payment required to reach the desired interest rate.</p>
        </div>

        <div id="disclaimer">
            <h2>Disclaimer</h2>
            <p>This calculator provides estimates based on the input values and is intended for illustrative purposes only. Actual loan terms may vary based on credit and lender policies.</p>
        </div>
    </div>

    <script>
        // JavaScript code...
        function calculateLoan() {
            // Get input values
            var amount = parseFloat(document.getElementById('amount').value) || 0;
            var interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            var desiredInterestRate = parseFloat(document.getElementById('desiredInterestRate').value) || 0;
            var loanTermIndex = parseInt(document.getElementById('loanTerm').value, 10);
            var monthlyInterestRate = (interestRate / 100) / 12;

            var terms = [84, 96, 120, 144, 180, 204, 240];
            var loanTerm = terms[loanTermIndex];

            function calculatePayment(term) {
                if (interestRate === 0) {
                    return amount / term;
                }
                return amount * monthlyInterestRate / (1 - Math.pow(1 + monthlyInterestRate, -term));
            }

            if (loanTerm <= 0 || amount <= 0) {
                alert("Please ensure that the loan amount and term are correctly set.");
                return;
            }

            var standardPayment = calculatePayment(loanTerm);

            // Calculation for extra payment required to reach desired interest rate...
            var extraPaymentToReachDesiredRate = ((monthlyInterestRate * amount) - (monthlyInterestRate * amount * (Math.pow((1 + monthlyInterestRate), (-loanTerm)))) - (desiredInterestRate / 100) / 12 * amount) / (1 - (Math.pow((1 + monthlyInterestRate), (-loanTerm))));
            
            var totalPaymentWithExtra = standardPayment + extraPaymentToReachDesiredRate;
            var totalInterestWithoutExtra = standardPayment * loanTerm - amount;

            var currentBalance = amount;
            var totalInterestPaidWithExtra = 0;
            var monthsWithExtra = 0;
            while (currentBalance > 0) {
                var interestForThisMonth = currentBalance * monthlyInterestRate;
                var principalForThisMonth = Math.min(standardPayment - interestForThisMonth + extraPaymentToReachDesiredRate, currentBalance);
                currentBalance -= principalForThisMonth;
                totalInterestPaidWithExtra += interestForThisMonth;
                monthsWithExtra++;
                if (monthsWithExtra >= loanTerm) break;
            }

            var effectiveInterestRate = (extraPaymentToReachDesiredRate > 0) ? (totalInterestPaidWithExtra / amount) / (monthsWithExtra / 12) * 100 : interestRate;
            var interestSaved = totalInterestWithoutExtra - totalInterestPaidWithExtra;
            var monthsReduced = loanTerm - monthsWithExtra;

            // Update results...
            var resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class='result-highlight'>
                    <h3>Loan Payment Details:</h3>
                    <p>Base Monthly Payment (Principal + Interest): ${standardPayment.toFixed(2)}</p>
                    <p>Additional Principal Payment: ${extraPaymentToReachDesiredRate.toFixed(2)}</p>
                    <p>Total Monthly Payment: ${totalPaymentWithExtra.toFixed(2)}</p>
                    <p>Effective Interest Rate: ${effectiveInterestRate.toFixed(2)}%</p>
                    <p>Interest Saved: ${interestSaved.toFixed(2)}</p>
                    <p>Loan will be paid off in ${monthsWithExtra} months, ${monthsReduced} months sooner than the original term.</p>
                    <p>Extra Monthly Payment Required to Reach Desired Interest Rate: ${extraPaymentToReachDesiredRate.toFixed(2)}</p>
                </div>
                <!-- ... code for displaying other loan terms ... -->
            `;
        }
    </script>
</body>
</html>
